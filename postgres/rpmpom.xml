<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>${artifactgroupname}</groupId>
	<artifactId>${artifactname}</artifactId>
	<version>${artifactversion}</version>
	<packaging>${packaging.type}</packaging>
	<name>categorization</name>
	<description>categorization</description>

	<properties>
		<buildnumber>${BUILD_NUMBER}</buildnumber>
		<patchnumber>${PATCH_NUMBER}</patchnumber>
	</properties>

	<distributionManagement>
		<repository>
			<id>Nexus</id>
			<name>Yodlee Releases</name>
			<url>https://sdp-qa-nexus.corp.yodlee.com:1443/nexus/content/repositories/yodlee</url>
		</repository>
	</distributionManagement>

	<profiles>
		<profile>
			<id>rpmbuild</id>
			<properties>
				<artifactgroupname>${APP_NAME}</artifactgroupname>
				<artifactname>${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release</artifactname>
				<artifactversion>${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release</artifactversion>
				<packaging.type>rpm</packaging.type>
			</properties>
			<build>
				<plugins>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>rpm-maven-plugin</artifactId>
						<version>2.1-alpha-3</version>
						<extensions>true</extensions>
						<executions>
							<execution>
								<goals>
									<goal>rpm</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<copyright>Copyright (c) 2014 Yodlee, Inc. All Rights Reserved. </copyright>
							<group>CategorizationApplication</group>
							<release>${RELEASE_VERSION}_release</release>
							<needarch>noarch</needarch>
							<noarch>false</noarch>
							<mappings>
								<mapping>
									<directory>/opt/yodlee/${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release/categorizationService.war/</directory>
									<sources>
										<source>
											<location>./target/categorizationService</location>
										</source>
										<source>
											<location>../../../../build_scripts/version.info</location>
										</source>
									</sources>
								</mapping>
							</mappings>
						</configuration>
					</plugin>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>build-helper-maven-plugin</artifactId>
						<version>1.7</version>
						<executions>
							<execution>
								<id>attach-artifacts</id>
								<phase>package</phase>
								<goals>
									<goal>attach-artifact</goal>
								</goals>
								<configuration>
									<artifacts>
										<artifact>
											<file>${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release.json</file>
											<type>json</type>
										</artifact>
									</artifacts>
								</configuration>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>com.google.code.maven-replacer-plugin</groupId>
						<artifactId>replacer</artifactId>
						<version>1.5.2</version>
						<executions>
							<execution>
								<phase>package</phase>
								<goals>
									<goal>replace</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<file>${APP_NAME}.json.temp</file>
							<replacements>
								<replacement>
									<token>${APP_NAME}-version</token>
									<value>${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release</value>
								</replacement>
								<replacement>
									<token>${APP_NAME}-name</token>
									<value>${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release</value>
								</replacement>
								<replacement>
									<token>versionvalue</token>
									<value>${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}</value>
								</replacement>
								<replacement>
									<token>releasevalue</token>
									<value>${JSON_RELEASE_VERSION}_release</value>
								</replacement>
							</replacements>
						</configuration>
					</plugin>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
						<version>1.7</version>
						<executions>
							<execution>
								<id>execution1</id>
								<phase>generate-sources</phase>
								<goals>
									<goal>run</goal>
								</goals>
								<configuration>
									<target>
										<copy file="./${APP_NAME}.json" tofile="./${APP_NAME}.json.temp"/>
									</target>
								</configuration>
							</execution>
							<execution>
								<id>execution2</id>
								<phase>package</phase>
								<goals>
									<goal>run</goal>
								</goals>
								<configuration>
									<target>
										<copy file="./${APP_NAME}.json.temp" tofile="./${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release.json" />
									</target>
								</configuration>
							</execution>
							<execution>
								<id>removingtempfile</id>
								<phase>verify</phase>
								<goals>
									<goal>run</goal>
								</goals>
								<configuration>
									<target>
										<delete file="${APP_NAME}.json.temp"/>
									</target>
								</configuration>
							</execution>
							<execution>
								<id>execution3</id>
								<phase>package</phase>
								<goals>
									<goal>run</goal>
								</goals>
								<configuration>
									<target>
										<exec dir="." executable="sh" outputproperty="diskspace">
											<arg value="-c"/>
											<arg line="&quot; du -b target/rpm/${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release/buildroot|tail -1|awk '{print $1}' &quot;"/>
										</exec>
										<exec dir="." executable="sh">
											<arg value="-c"/>
											<arg line="&quot; sed -i 's/sizevalue/${diskspace}/g' ${APP_NAME}-${BUILD_NUMBER}_${PATCH_NUMBER}_${BUILD_TYPE}_${BRANCH}-${RELEASE_VERSION}_release.json &quot;"/>
										</exec>
									</target>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>
</project>
